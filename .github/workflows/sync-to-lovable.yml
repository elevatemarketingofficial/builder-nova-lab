name: Sync to Lovable

on:
  push:
    branches: [main]

jobs:
  deploy:
    runs-on: ubuntu-latest

    steps:
      # â€”â€”â€” 1. Check out the Builder.io repo into ./builder â€”â€”â€”
      - name: Checkout Builder Repo
        uses: actions/checkout@v4
        with:
          path: builder

      # â€”â€”â€” 2. Debug the token to confirm it exists â€”â€”â€”
      - name: Debug PAT presence
        run: echo "LOVABLE_PAT length = ${#LOVABLE_PAT}"
        env:
          LOVABLE_PAT: ${{ secrets.LOVABLE_PAT }}

      # â€”â€”â€” 3. Clone the Lovable-linked repo into ./lovable using GitHub Checkout â€”â€”â€”
      - name: Clone Lovable Repo
        uses: actions/checkout@v4
        with:
          repository: elevatemarketingofficial/silent-observer-node
          path: lovable
          token: '${{ secrets.LOVABLE_PAT }}'

      # â€”â€”â€” 4. Sync Builder files into Lovable repo â€”â€”â€”
      - name: Sync Builder â†’ Lovable
        run: |
          rsync -av --delete \
            --exclude='.git' \
            --exclude='.lovable' \
            --exclude='lovable.json' \
            builder/ lovable/

          cd lovable
          git config user.name "Builder Sync Bot"
          git config user.email "builder-sync@elevate.com"
          git add .
          git diff --cached --quiet || git commit -m "ğŸ” Auto-sync from builder-nova-lab"
          git push origin main
