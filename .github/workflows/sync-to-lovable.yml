name: Sync to Lovable

on:
  push:
    branches: [main]

jobs:
  deploy:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout Builder Repo
        uses: actions/checkout@v4

      - name: Clone Lovable Repo
        env:
          GH_TOKEN: ${{ secrets.LOVABLE_PAT }}
        run: |
          git clone https://x-access-token:${GH_TOKEN}@github.com/elevatemarketingofficial/silent-observer-node.git lovable
          rsync -av --delete \
            --exclude='.git' \
            --exclude='.lovable' \
            --exclude='lovable.json' \
            ./ lovable/
          cd lovable
          git config user.name "Builder Sync Bot"
          git config user.email "builder-sync@elevate.com"
          git add .
          git diff --cached --quiet || git commit -m "üîÅ Auto-sync from builder-nova-lab"
          git push origin main