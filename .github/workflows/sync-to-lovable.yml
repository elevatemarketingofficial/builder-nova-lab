name: Sync to Lovable

on:
  push:
    branches: [main]

jobs:
  deploy:
    runs-on: ubuntu-latest

    steps:
      # ——— 1. Check out the Builder.io repo into ./builder ———
      - name: Checkout Builder Repo
        uses: actions/checkout@v4
        with:
          path: builder

      # ——— 2. Clone the Lovable-linked repo into ./lovable ———
      - name: Clone Lovable Repo
        env:
          LOVABLE_PAT: ${{ secrets.LOVABLE_PAT }}
          GIT_LFS_SKIP_SMUDGE: "1"
        run: git clone --depth 1 https://x-access-token:${LOVABLE_PAT}@github.com/elevatemarketingofficial/silent-observer-node.git lovable
      # ——— 3. Sync Builder files into Lovable repo ———
      - name: Sync Builder → Lovable
        run: |
          rsync -av --delete \
            --exclude='.git' \
            --exclude='.lovable' \
            --exclude='lovable.json' \
            builder/ lovable/

          cd lovable
          git config user.name "Builder Sync Bot"
          git config user.email "builder-sync@elevate.com"
          git add .
          git diff --cached --quiet || git commit -m "🔁 Auto-sync from builder-nova-lab"
          git push origin main
